{"config":{"lang":["en","ru"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"architecture/","title":"Architecture","text":""},{"location":"architecture/#protocol-format","title":"Protocol Format","text":"<p>The iproto protocol uses a simple binary format with a 12-byte header followed by a variable-length payload.</p>"},{"location":"architecture/#header-12-bytes","title":"Header (12 bytes)","text":"<pre><code>+--------+--------+--------+--------+\n| Msg (4 bytes, little-endian)      |  Message/method code\n+--------+--------+--------+--------+\n| Len (4 bytes, little-endian)      |  Payload length in bytes\n+--------+--------+--------+--------+\n| Sync (4 bytes, little-endian)     |  Request-response correlation ID\n+--------+--------+--------+--------+\n| Data (Len bytes)                  |  Payload\n+--------+--------+--------+--------+\n</code></pre> <ul> <li>Msg \u2014 identifies the request type (method code). Used by <code>ServeMux</code> for routing.</li> <li>Len \u2014 length of the data payload.</li> <li>Sync \u2014 auto-incrementing ID that correlates requests with responses.</li> </ul>"},{"location":"architecture/#control-messages","title":"Control Messages","text":"Code Name Purpose <code>0xff00</code> <code>MessagePing</code> Keepalive ping <code>0xff01</code> <code>MessageShutdown</code> Graceful shutdown handshake"},{"location":"architecture/#channel","title":"Channel","text":"<p><code>Channel</code> manages a single TCP connection. It runs two goroutines \u2014 one for reading and one for writing packets.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Channel                 \u2502\n\u2502                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  Reader   \u2502     \u2502   Writer     \u2502   \u2502\n\u2502  \u2502 goroutine \u2502     \u2502  goroutine   \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502        \u2502                  \u2502           \u2502\n\u2502        \u25bc                  \u25b2           \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502   \u2502 Handler \u2502      \u2502   out   \u2502       \u2502\n\u2502   \u2502  (user) \u2502      \u2502  chan   \u2502       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502   \u2502   Pending Store         \u2502        \u2502\n\u2502   \u2502   map[msg&lt;&lt;32|sync] fn  \u2502        \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Request-response flow:</p> <ol> <li><code>Call()</code> registers a callback in the pending store keyed by <code>(Msg &lt;&lt; 32) | Sync</code>.</li> <li>The packet is sent to the <code>out</code> channel for the writer goroutine.</li> <li>When a response arrives, the reader matches it by <code>(Msg, Sync)</code> and invokes the callback.</li> </ol> <p>Lifecycle:</p> <ul> <li><code>NewChannel(conn, config)</code> \u2014 create a channel.</li> <li><code>Init()</code> \u2014 start reader/writer goroutines.</li> <li><code>Shutdown()</code> \u2014 graceful shutdown with a bidirectional handshake.</li> <li><code>Close()</code> \u2014 immediate close.</li> <li><code>Done()</code> \u2014 channel that signals when fully closed.</li> </ul> <p>Features:</p> <ul> <li>Configurable ping/keepalive with <code>PingInterval</code>.</li> <li>Idle timeout with <code>IdleTimeout</code>.</li> <li>Size limit per packet with <code>SizeLimit</code> (default 100 MB).</li> <li>Connection hijacking with <code>Hijack()</code>.</li> </ul>"},{"location":"architecture/#pool","title":"Pool","text":"<p><code>Pool</code> manages multiple Channels to a single server address.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Pool                \u2502\n\u2502                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 Channel  \u2502  \u2502 Channel  \u2502 ... \u2502\n\u2502  \u2502    #0    \u2502  \u2502    #1    \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                  \u2502\n\u2502  Round-robin load balancing      \u2502\n\u2502  Automatic reconnect             \u2502\n\u2502  Rate limiting (token bucket)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key behaviors:</p> <ul> <li>Load balancing \u2014 round-robin via <code>NextChannel()</code>.</li> <li>Auto reconnect \u2014 uses <code>BackgroundDialer</code> with configurable backoff.</li> <li>Rate limiting \u2014 optional token bucket limiter with shaping or policing mode.</li> <li>FailOnCutoff \u2014 when enabled, calls fail immediately if no channels are online.</li> </ul>"},{"location":"architecture/#server","title":"Server","text":"<p><code>Server</code> accepts incoming TCP connections and creates a Channel for each.</p> <pre><code>srv := &amp;iproto.Server{\n    ChannelConfig: &amp;iproto.ChannelConfig{\n        Handler: myHandler,\n    },\n}\nsrv.ListenAndServe(ctx, \"tcp\", \":3301\")\n</code></pre> <p>The <code>Accept</code> field allows customizing Channel creation (e.g., per-connection handler pools).</p>"},{"location":"architecture/#servemux","title":"ServeMux","text":"<p><code>ServeMux</code> routes incoming packets to handlers based on <code>Header.Msg</code>:</p> <pre><code>mux := iproto.NewServeMux()\nmux.Handle(1, echoHandler)\nmux.Handle(2, timeHandler)\n</code></pre> <p>When a packet arrives, <code>ServeMux.ServeIProto</code> looks up the handler by message code and dispatches.</p>"},{"location":"architecture/#serialization","title":"Serialization","text":""},{"location":"architecture/#default-mode-little-endian-fixed-width","title":"Default Mode (Little-Endian Fixed-Width)","text":"Type Wire Size <code>uint8</code> / <code>int8</code> 1 byte <code>uint16</code> / <code>int16</code> 2 bytes <code>uint32</code> / <code>int32</code> / <code>int</code> / <code>uint</code> 4 bytes <code>uint64</code> / <code>int64</code> 8 bytes <code>string</code> / <code>[]byte</code> 4-byte length prefix + data <code>struct</code> fields encoded in order <code>slice</code> 4-byte count prefix + elements"},{"location":"architecture/#ber-mode-variable-length","title":"BER Mode (Variable-Length)","text":"<p>BER encoding uses 7 bits per byte, with the high bit indicating continuation. Small values take fewer bytes:</p> <ul> <li><code>5</code> \u2192 <code>05</code> (1 byte)</li> <li><code>128</code> \u2192 <code>81 00</code> (2 bytes)</li> <li><code>100000</code> \u2192 <code>86 8d 20</code> (3 bytes)</li> </ul> <p>Use struct tags to mix modes:</p> <pre><code>type Message struct {\n    Count uint32 `iproto:\"ber\"`  // BER-encoded\n    Name  string                 // Default (LE fixed)\n}\n</code></pre>"},{"location":"architecture/#syncutil","title":"syncutil","text":"<p>Concurrency primitives used internally and available for user code:</p> <ul> <li>TaskGroup \u2014 execute up to N tasks concurrently. Returns channels for results.</li> <li>TaskRunner \u2014 run exactly one task; multiple callers subscribe to the same result.</li> <li>Throttle \u2014 rate-limit function execution to at most once per time period.</li> <li>Multitask / Every / Each \u2014 run N tasks in parallel with cancellation.</li> </ul>"},{"location":"contributing/","title":"Contributing","text":"<p>Thank you for your interest in contributing! This document provides guidelines for contributing to the project.</p>"},{"location":"contributing/#reporting-bugs","title":"Reporting Bugs","text":"<ul> <li>Check existing issues to avoid duplicates.</li> <li>Open a new issue with a clear title and description.</li> <li>Include Go version, OS, and a minimal reproducing example.</li> </ul>"},{"location":"contributing/#suggesting-improvements","title":"Suggesting Improvements","text":"<ul> <li>Open an issue describing the improvement and its motivation.</li> <li>For significant changes, discuss the approach before submitting a PR.</li> </ul>"},{"location":"contributing/#development-setup","title":"Development Setup","text":"<ol> <li>Go 1.24+ \u2014 https://go.dev/dl/</li> <li>golangci-lint \u2014 https://golangci-lint.run/welcome/install/</li> <li>make \u2014 for running targets</li> </ol> <pre><code>git clone https://github.com/Educentr/go-iproto.git\ncd go-iproto\nmake test\nmake lint\n</code></pre>"},{"location":"contributing/#code-style","title":"Code Style","text":"<ul> <li>Format with <code>gofmt</code> and <code>goimports</code>.</li> <li>Run <code>make lint</code> before committing.</li> <li>Follow existing code conventions in the project.</li> </ul>"},{"location":"contributing/#pull-request-process","title":"Pull Request Process","text":"<ol> <li>Fork the repository and create a feature branch.</li> <li>Make your changes with clear commit messages.</li> <li>Ensure <code>make test</code> and <code>make lint</code> pass.</li> <li>Submit a PR against the <code>main</code> branch.</li> <li>Describe what the PR does and link any related issues.</li> </ol>"},{"location":"contributing/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the MIT License.</p>"},{"location":"examples/","title":"Examples","text":"<p>All examples are in the <code>examples/</code> directory and can be run with <code>go run</code>.</p>"},{"location":"examples/#echo-server","title":"Echo Server","text":"<p>A basic echo server that returns any data it receives.</p> <pre><code>go run ./examples/echo\n</code></pre> <pre><code>// Server handler: echo data back.\nhandler := iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n    _ = c.Send(ctx, iproto.ResponseTo(p, p.Data))\n})\n\nsrv := &amp;iproto.Server{\n    ChannelConfig: &amp;iproto.ChannelConfig{Handler: handler},\n}\ngo srv.Serve(ctx, ln)\n\n// Client: send and receive.\npool, _ := iproto.Dial(ctx, \"tcp\", addr, &amp;iproto.PoolConfig{Size: 1})\ndata := iproto.PackString(nil, \"Hello, iproto!\", iproto.ModeDefault)\nresp, _ := pool.Call(ctx, 1, data)\n</code></pre>"},{"location":"examples/#connection-pool","title":"Connection Pool","text":"<p>Multiple goroutines sending requests through a pool of 4 connections. The server doubles each <code>uint32</code>.</p> <pre><code>go run ./examples/pool\n</code></pre> <pre><code>// Server: double the input.\nhandler := iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n    var in uint32\n    iproto.UnpackUint32(bytes.NewReader(p.Data), &amp;in, 0)\n    _ = c.Send(ctx, iproto.ResponseTo(p, iproto.PackUint32(nil, in*2, 0)))\n})\n\n// Pool with 4 connections, 8 concurrent workers.\npool, _ := iproto.Dial(ctx, \"tcp\", addr, &amp;iproto.PoolConfig{Size: 4})\n\nvar wg sync.WaitGroup\nfor w := range 8 {\n    wg.Add(1)\n    go func(id int) {\n        defer wg.Done()\n        for i := range uint32(100) {\n            resp, _ := pool.Call(ctx, 1, iproto.PackUint32(nil, i, 0))\n            // verify result...\n        }\n    }(w)\n}\nwg.Wait()\nfmt.Println(\"stats:\", pool.Stats())\n</code></pre>"},{"location":"examples/#binary-packing","title":"Binary Packing","text":"<p>Pack and unpack primitive types, BER encoding, and structs with tags.</p> <pre><code>go run ./examples/packing\n</code></pre> <pre><code>// Primitive types.\ndata, _ := iproto.Pack(uint32(258))\n// -&gt; 02010000\n\n// BER encoding (variable length).\ndata, _ = iproto.PackBER(uint32(128))\n// -&gt; 8100\n\n// Struct with mixed modes.\ntype Message struct {\n    Count uint32 `iproto:\"ber\"`\n    Name  string\n}\ndata, _ = iproto.Pack(Message{Count: 258, Name: \"world\"})\n\nvar msg Message\niproto.Unpack(data, &amp;msg)\n</code></pre>"},{"location":"examples/#servemux-routing","title":"ServeMux Routing","text":"<p>Register handlers for different message codes. The client calls each one.</p> <pre><code>go run ./examples/mux\n</code></pre> <pre><code>mux := iproto.NewServeMux()\n\n// Echo handler on message code 1.\nmux.Handle(1, iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n    _ = c.Send(ctx, iproto.ResponseTo(p, p.Data))\n}))\n\n// Time handler on message code 2.\nmux.Handle(2, iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n    now := time.Now().Format(time.RFC3339)\n    _ = c.Send(ctx, iproto.ResponseTo(p, iproto.PackString(nil, now, iproto.ModeDefault)))\n}))\n\nsrv := &amp;iproto.Server{\n    ChannelConfig: &amp;iproto.ChannelConfig{Handler: mux},\n}\n\n// Client calls different methods.\npool, _ := iproto.Dial(ctx, \"tcp\", addr, nil)\nresp, _ := pool.Call(ctx, 1, echoData)   // -&gt; echo handler\nresp, _ = pool.Call(ctx, 2, nil)          // -&gt; time handler\n</code></pre>"},{"location":"getting-started/","title":"Getting Started","text":""},{"location":"getting-started/#installation","title":"Installation","text":"<pre><code>go get github.com/Educentr/go-iproto\n</code></pre> <p>Requires Go 1.24 or later.</p>"},{"location":"getting-started/#your-first-server","title":"Your First Server","text":"<p>Create a simple echo server that returns any data it receives:</p> <pre><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n\n    \"github.com/Educentr/go-iproto/iproto\"\n)\n\nfunc main() {\n    handler := iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n        _ = c.Send(ctx, iproto.ResponseTo(p, p.Data))\n    })\n\n    log.Fatal(iproto.ListenAndServe(context.Background(), \"tcp\", \":3301\", handler))\n}\n</code></pre>"},{"location":"getting-started/#your-first-client","title":"Your First Client","text":"<p>Connect to the server and send a request:</p> <pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"log\"\n\n    \"github.com/Educentr/go-iproto/iproto\"\n)\n\nfunc main() {\n    pool, err := iproto.Dial(context.Background(), \"tcp\", \"127.0.0.1:3301\", nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer pool.Close()\n\n    resp, err := pool.Call(context.Background(), 1, []byte(\"hello\"))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"response: %s\\n\", resp)\n}\n</code></pre>"},{"location":"getting-started/#package-structure","title":"Package Structure","text":"Package Import Path Description iproto <code>github.com/Educentr/go-iproto/iproto</code> Core protocol: Channel, Pool, Server, ServeMux, Pack/Unpack netutil <code>github.com/Educentr/go-iproto/netutil</code> Dialer with retry/backoff, BackgroundDialer syncutil <code>github.com/Educentr/go-iproto/syncutil</code> TaskGroup, TaskRunner, Throttle, Multitask"},{"location":"getting-started/#key-concepts","title":"Key Concepts","text":"<ul> <li>Channel manages a single TCP connection. It handles reading/writing packets, ping/keepalive, and request-response correlation via a <code>Sync</code> ID.</li> <li>Pool manages multiple Channels to one server. It provides load balancing (round-robin), automatic reconnection, and optional rate limiting.</li> <li>Server accepts incoming TCP connections and creates a Channel for each one.</li> <li>ServeMux routes incoming packets to handlers based on the message code (<code>Header.Msg</code>).</li> <li>Pack/Unpack provides binary serialization. Integers are little-endian by default, with optional BER (variable-length) encoding.</li> </ul>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Architecture \u2014 protocol internals</li> <li>API Reference \u2014 detailed API documentation</li> <li>Examples \u2014 more runnable examples</li> </ul>"},{"location":"","title":"go-iproto","text":"<p>Go implementation of the iproto binary protocol \u2014 a lightweight, high-performance framework for binary RPC communication.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Channel \u2014 single connection with request-response correlation, ping/keepalive, graceful shutdown</li> <li>Pool \u2014 connection pool with load balancing, automatic reconnect, and rate limiting</li> <li>Server / ServeMux \u2014 accept connections with handler routing by message code</li> <li>Pack / Unpack \u2014 binary serialization for integers, strings, structs with BER encoding</li> <li>netutil \u2014 Dialer with retry/backoff and background dial</li> <li>syncutil \u2014 concurrency primitives: TaskGroup, TaskRunner, Throttle, Multitask</li> </ul>"},{"location":"#installation","title":"Installation","text":"<pre><code>go get github.com/Educentr/go-iproto\n</code></pre> <p>Requires Go 1.24+.</p>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>// Server\nhandler := iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n    _ = c.Send(ctx, iproto.ResponseTo(p, p.Data))\n})\niproto.ListenAndServe(ctx, \"tcp\", \":3301\", handler)\n\n// Client\npool, _ := iproto.Dial(ctx, \"tcp\", \"127.0.0.1:3301\", nil)\nresp, _ := pool.Call(ctx, 1, []byte(\"hello\"))\n</code></pre>"},{"location":"#links","title":"Links","text":"<ul> <li>Getting Started \u2014 step-by-step guide</li> <li>Architecture \u2014 protocol design and internals</li> <li>API Reference \u2014 types, functions, constants</li> <li>Examples \u2014 runnable code examples</li> <li>GitHub</li> <li>pkg.go.dev</li> </ul>"},{"location":"api/iproto/","title":"iproto Package","text":"<p><code>import \"github.com/Educentr/go-iproto/iproto\"</code></p> <p>Full API reference: pkg.go.dev</p>"},{"location":"api/iproto/#types","title":"Types","text":""},{"location":"api/iproto/#header","title":"Header","text":"<pre><code>type Header struct {\n    Msg  uint32 // Message/method code\n    Len  uint32 // Payload length\n    Sync uint32 // Request-response correlation ID\n}\n</code></pre>"},{"location":"api/iproto/#packet","title":"Packet","text":"<pre><code>type Packet struct {\n    Header Header\n    Data   []byte\n}\n</code></pre>"},{"location":"api/iproto/#handler","title":"Handler","text":"<pre><code>type Handler interface {\n    ServeIProto(ctx context.Context, c Conn, p Packet)\n}\n\ntype HandlerFunc func(context.Context, Conn, Packet)\n</code></pre>"},{"location":"api/iproto/#conn","title":"Conn","text":"<pre><code>type Conn interface {\n    Sender\n    Closer\n    GetBytes(n int) []byte\n    PutBytes(p []byte)\n    RemoteAddr() net.Addr\n    LocalAddr() net.Addr\n}\n</code></pre>"},{"location":"api/iproto/#sender","title":"Sender","text":"<pre><code>type Sender interface {\n    Call(ctx context.Context, message uint32, data []byte) ([]byte, error)\n    Notify(ctx context.Context, message uint32, data []byte) error\n    Send(ctx context.Context, packet Packet) error\n}\n</code></pre>"},{"location":"api/iproto/#channel","title":"Channel","text":"<p>Single iproto connection.</p> <pre><code>func NewChannel(conn net.Conn, config *ChannelConfig) *Channel\nfunc RunChannel(conn net.Conn, config *ChannelConfig) (*Channel, error)\n</code></pre> <p>Key methods:</p> Method Description <code>Init()</code> Start reader/writer goroutines <code>Call(ctx, msg, data)</code> Send request, wait for response <code>Notify(ctx, msg, data)</code> Send fire-and-forget notification <code>Send(ctx, packet)</code> Send raw packet <code>Shutdown()</code> Graceful shutdown <code>Close()</code> Immediate close <code>Done()</code> Closure signal channel <code>Stats()</code> Get <code>ChannelStats</code> <code>Hijack()</code> Take over the connection"},{"location":"api/iproto/#channelconfig","title":"ChannelConfig","text":"Field Type Default Description <code>Handler</code> <code>Handler</code> \u2014 Incoming packet handler <code>RequestTimeout</code> <code>time.Duration</code> 5s Call timeout <code>NoticeTimeout</code> <code>time.Duration</code> 1s Notify timeout <code>PingInterval</code> <code>time.Duration</code> 1m Keepalive interval <code>IdleTimeout</code> <code>time.Duration</code> 0 Idle connection timeout <code>ShutdownTimeout</code> <code>time.Duration</code> 5s Shutdown handshake timeout <code>SizeLimit</code> <code>uint32</code> 1e8 Max packet size <code>WriteQueueSize</code> <code>int</code> 50 Output buffer size <code>Init</code> <code>func(context.Context, *Channel) error</code> nil Post-init callback"},{"location":"api/iproto/#pool","title":"Pool","text":"<p>Connection pool to a single server.</p> <pre><code>func Dial(ctx context.Context, network, addr string, config *PoolConfig) (*Pool, error)\nfunc NewPool(network, addr string, config *PoolConfig) *Pool\n</code></pre> <p>Key methods:</p> Method Description <code>Init(ctx)</code> Initialize one connection <code>InitAll(ctx)</code> Initialize all connections <code>Call(ctx, msg, data)</code> Call via any available channel <code>Notify(ctx, msg, data)</code> Notify via any channel <code>NextChannel(ctx)</code> Get next channel (round-robin) <code>Online()</code> List of active channels <code>Stats()</code> Get <code>PoolStats</code> <code>Shutdown()</code> Graceful shutdown <code>Close()</code> Immediate close"},{"location":"api/iproto/#poolconfig","title":"PoolConfig","text":"Field Type Default Description <code>Size</code> <code>int</code> 1 Number of connections <code>ChannelConfig</code> <code>*ChannelConfig</code> \u2014 Config for each channel <code>ConnectTimeout</code> <code>time.Duration</code> 1s Max wait for available channel <code>RedialInterval</code> <code>time.Duration</code> 10ms Initial retry delay <code>RedialTimeout</code> <code>time.Duration</code> 1h Max total dial time <code>RedialForever</code> <code>bool</code> false Disable dial timeout <code>FailOnCutoff</code> <code>bool</code> false Fail fast when offline <code>RateLimit</code> <code>rate.Limit</code> 0 Token bucket rate <code>RateBurst</code> <code>int</code> 0 Token bucket burst (0 = disabled) <code>RateWait</code> <code>bool</code> false Shape (true) or police (false)"},{"location":"api/iproto/#server","title":"Server","text":"<pre><code>type Server struct {\n    Accept        AcceptFn\n    ChannelConfig *ChannelConfig\n    Log           Logger\n    OnClose       []func()\n    OnShutdown    []func()\n}\n\nfunc ListenAndServe(ctx context.Context, network, addr string, h Handler) error\n</code></pre>"},{"location":"api/iproto/#servemux","title":"ServeMux","text":"<pre><code>func NewServeMux() *ServeMux\nfunc (s *ServeMux) Handle(message uint32, handler Handler)\nfunc (s *ServeMux) Handler(message uint32) Handler\n</code></pre>"},{"location":"api/iproto/#pack-unpack","title":"Pack / Unpack","text":"<pre><code>func Pack(value ...any) ([]byte, error)\nfunc PackBER(value ...any) ([]byte, error)\nfunc Append(data []byte, value ...any) ([]byte, error)\nfunc Unpack(data []byte, value ...any) ([]byte, error)\nfunc UnpackBER(data []byte, value ...any) ([]byte, error)\n</code></pre> <p>Per-type functions:</p> <pre><code>func PackUint8(w []byte, v uint8, mode PackMode) []byte\nfunc PackUint16(w []byte, v uint16, mode PackMode) []byte\nfunc PackUint32(w []byte, v uint32, mode PackMode) []byte\nfunc PackUint64(w []byte, v uint64, mode PackMode) []byte\nfunc PackString(w []byte, v string, mode PackMode) []byte\nfunc PackBytes(w []byte, v []byte, mode PackMode) []byte\n</code></pre> <p>Custom serialization interfaces:</p> <pre><code>type Packer interface {\n    IprotoPack(w []byte, mode PackMode) ([]byte, error)\n}\n\ntype Unpacker interface {\n    IprotoUnpack(r *bytes.Reader, mode PackMode) error\n}\n</code></pre>"},{"location":"api/iproto/#errors","title":"Errors","text":"Variable Description <code>ErrTimeout</code> Request exceeded timeout <code>ErrDroppedConn</code> Connection was dropped <code>ErrStopped</code> Channel/pool is stopped <code>ErrHijacked</code> Channel was hijacked <code>ErrCutoff</code> Pool offline (FailOnCutoff mode) <code>ErrPoolFull</code> No space in pool <code>ErrNoChannel</code> Timeout getting channel <code>ErrPolicied</code> Rate limit rejected"},{"location":"api/iproto/#utility","title":"Utility","text":"<pre><code>func ResponseTo(p Packet, b []byte) Packet\nfunc CopyChannelConfig(c *ChannelConfig) *ChannelConfig\nfunc CopyPoolConfig(c *PoolConfig) *PoolConfig\n</code></pre>"},{"location":"api/netutil/","title":"netutil Package","text":"<p><code>import \"github.com/Educentr/go-iproto/netutil\"</code></p> <p>Full API reference: pkg.go.dev</p>"},{"location":"api/netutil/#dialer","title":"Dialer","text":"<p><code>Dialer</code> establishes a TCP connection with retry and exponential backoff.</p> <pre><code>type Dialer struct {\n    Network         string\n    Addr            string\n    Timeout         time.Duration        // Single dial timeout\n    LoopInterval    time.Duration        // Initial backoff (default 50ms)\n    MaxLoopInterval time.Duration        // Max backoff\n    NetDial         func(ctx, net, addr) (net.Conn, error)\n    OnAttempt       func(err error)      // Called after each attempt\n    Logf            func(string, ...any)\n    Debugf          func(string, ...any)\n}\n</code></pre> <p>Methods:</p> Method Description <code>Dial(ctx) (net.Conn, error)</code> Dial with retries until success or context cancellation"},{"location":"api/netutil/#backgrounddialer","title":"BackgroundDialer","text":"<p><code>BackgroundDialer</code> wraps <code>Dialer</code> for concurrent background dial management. Multiple callers can subscribe to the same dial operation.</p> <pre><code>type BackgroundDialer struct {\n    Dialer     *Dialer\n    TaskGroup  *syncutil.TaskGroup\n    TaskRunner *syncutil.TaskRunner\n}\n</code></pre> <p>Methods:</p> Method Description <code>Dial(ctx, callback) &lt;-chan error</code> Start or join background dial; callback receives the connection <code>Cancel()</code> Cancel current dial routine <code>SetDeadline(t time.Time)</code> Set absolute dial deadline <code>SetDeadlineAtLeast(t time.Time) time.Time</code> Set deadline if current is earlier"},{"location":"api/netutil/#usage-example","title":"Usage Example","text":"<pre><code>d := &amp;netutil.BackgroundDialer{\n    Dialer: &amp;netutil.Dialer{\n        Network: \"tcp\",\n        Addr:    \"127.0.0.1:3301\",\n        Timeout: 5 * time.Second,\n    },\n    TaskRunner: &amp;syncutil.TaskRunner{},\n}\n\ndone := d.Dial(ctx, func(conn net.Conn, err error) {\n    if err != nil {\n        log.Fatal(err)\n    }\n    // use conn\n})\n\n&lt;-done\n</code></pre>"},{"location":"api/syncutil/","title":"syncutil Package","text":"<p><code>import \"github.com/Educentr/go-iproto/syncutil\"</code></p> <p>Full API reference: pkg.go.dev</p>"},{"location":"api/syncutil/#taskgroup","title":"TaskGroup","text":"<p>Execute up to N concurrent tasks. Reuses slots as tasks complete.</p> <pre><code>type TaskGroup struct {\n    N    int    // Max concurrent tasks (default 1)\n    Goer GoerFn // Custom goroutine launcher (optional)\n}\n</code></pre> <p>Methods:</p> Method Description <code>Do(ctx, n, task) []&lt;-chan error</code> Start up to n tasks; returns result channels <code>Cancel()</code> Cancel all running tasks"},{"location":"api/syncutil/#example","title":"Example","text":"<pre><code>tg := &amp;syncutil.TaskGroup{N: 4}\n\nresults := tg.Do(ctx, 4, func(ctx context.Context, i int) error {\n    // task i runs concurrently\n    return nil\n})\n\nfor _, ch := range results {\n    if err := &lt;-ch; err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>"},{"location":"api/syncutil/#taskrunner","title":"TaskRunner","text":"<p>Run exactly one task at a time. Multiple callers subscribe to the same result.</p> <pre><code>type TaskRunner struct{}\n</code></pre> <p>Methods:</p> Method Description <code>Do(ctx, task) &lt;-chan error</code> Start task (or subscribe if already running) <code>Cancel()</code> Cancel current task"},{"location":"api/syncutil/#example_1","title":"Example","text":"<pre><code>var runner syncutil.TaskRunner\n\n// Both goroutines receive the same result.\nch1 := runner.Do(ctx, func(ctx context.Context) error {\n    return expensiveOperation(ctx)\n})\nch2 := runner.Do(ctx, func(ctx context.Context) error {\n    return expensiveOperation(ctx) // not started \u2014 subscribes to existing\n})\n\nerr1 := &lt;-ch1\nerr2 := &lt;-ch2 // same value as err1\n</code></pre>"},{"location":"api/syncutil/#throttle","title":"Throttle","text":"<p>Limit function execution to at most once per time period.</p> <pre><code>type Throttle struct {\n    Period time.Duration\n}\n</code></pre> <p>Methods:</p> Method Description <code>Next() bool</code> Returns true if the period has elapsed <code>Reset()</code> Clear the throttle <code>Set(time.Time)</code> Set specific throttle time"},{"location":"api/syncutil/#multitask","title":"Multitask","text":"<p>Run N tasks in parallel with cancellation support.</p> <pre><code>type Multitask struct {\n    ContinueOnError bool   // Don't cancel others on Goer failure\n    Goer            GoerFn // Custom goroutine launcher\n}\n</code></pre> <p>Methods:</p> Method Description <code>Do(ctx, n, actor) error</code> Run actor n times in parallel"},{"location":"api/syncutil/#helper-functions","title":"Helper Functions","text":"<pre><code>// Every runs n tasks; cancels all on first error.\nfunc Every(ctx context.Context, n int, actor func(context.Context, int) error) error\n\n// Each runs n tasks; waits for all to complete.\nfunc Each(ctx context.Context, n int, actor func(context.Context, int))\n</code></pre>"},{"location":"ru/architecture/","title":"\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430","text":""},{"location":"ru/architecture/#_2","title":"\u0424\u043e\u0440\u043c\u0430\u0442 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0430","text":"<p>\u041f\u0440\u043e\u0442\u043e\u043a\u043e\u043b iproto \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0431\u0438\u043d\u0430\u0440\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442: 12-\u0431\u0430\u0439\u0442\u043d\u044b\u0439 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b.</p>"},{"location":"ru/architecture/#12","title":"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a (12 \u0431\u0430\u0439\u0442)","text":"<pre><code>+--------+--------+--------+--------+\n| Msg (4 \u0431\u0430\u0439\u0442\u0430, little-endian)      |  \u041a\u043e\u0434 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f/\u043c\u0435\u0442\u043e\u0434\u0430\n+--------+--------+--------+--------+\n| Len (4 \u0431\u0430\u0439\u0442\u0430, little-endian)      |  \u0414\u043b\u0438\u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0431\u0430\u0439\u0442\u0430\u0445\n+--------+--------+--------+--------+\n| Sync (4 \u0431\u0430\u0439\u0442\u0430, little-endian)     |  ID \u043a\u043e\u0440\u0440\u0435\u043b\u044f\u0446\u0438\u0438 \u0437\u0430\u043f\u0440\u043e\u0441-\u043e\u0442\u0432\u0435\u0442\n+--------+--------+--------+--------+\n| Data (Len \u0431\u0430\u0439\u0442)                   |  \u0414\u0430\u043d\u043d\u044b\u0435\n+--------+--------+--------+--------+\n</code></pre> <ul> <li>Msg \u2014 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u0442\u0438\u043f \u0437\u0430\u043f\u0440\u043e\u0441\u0430 (\u043a\u043e\u0434 \u043c\u0435\u0442\u043e\u0434\u0430). \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f <code>ServeMux</code> \u0434\u043b\u044f \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0438.</li> <li>Len \u2014 \u0434\u043b\u0438\u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u0445.</li> <li>Sync \u2014 \u0430\u0432\u0442\u043e\u0438\u043d\u043a\u0440\u0435\u043c\u0435\u043d\u0442\u043d\u044b\u0439 ID \u0434\u043b\u044f \u043a\u043e\u0440\u0440\u0435\u043b\u044f\u0446\u0438\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0438 \u043e\u0442\u0432\u0435\u0442\u043e\u0432.</li> </ul>"},{"location":"ru/architecture/#_3","title":"\u0423\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f","text":"\u041a\u043e\u0434 \u0418\u043c\u044f \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 <code>0xff00</code> <code>MessagePing</code> Keepalive ping <code>0xff01</code> <code>MessageShutdown</code> Graceful shutdown handshake"},{"location":"ru/architecture/#channel","title":"Channel","text":"<p><code>Channel</code> \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0434\u043d\u0438\u043c TCP-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435\u043c. \u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0434\u0432\u0435 \u0433\u043e\u0440\u0443\u0442\u0438\u043d\u044b \u2014 \u0447\u0442\u0435\u043d\u0438\u0435 \u0438 \u0437\u0430\u043f\u0438\u0441\u044c \u043f\u0430\u043a\u0435\u0442\u043e\u0432.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Channel                 \u2502\n\u2502                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  Reader   \u2502     \u2502   Writer     \u2502   \u2502\n\u2502  \u2502 goroutine \u2502     \u2502  goroutine   \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502        \u2502                  \u2502           \u2502\n\u2502        \u25bc                  \u25b2           \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502   \u2502 Handler \u2502      \u2502   out   \u2502       \u2502\n\u2502   \u2502  (user) \u2502      \u2502  chan   \u2502       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502   \u2502   Pending Store         \u2502        \u2502\n\u2502   \u2502   map[msg&lt;&lt;32|sync] fn  \u2502        \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u041f\u0440\u043e\u0446\u0435\u0441\u0441 \u0437\u0430\u043f\u0440\u043e\u0441-\u043e\u0442\u0432\u0435\u0442:</p> <ol> <li><code>Call()</code> \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442 \u043a\u043e\u043b\u0431\u044d\u043a \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043a\u043b\u044e\u0447\u0443 <code>(Msg &lt;&lt; 32) | Sync</code>.</li> <li>\u041f\u0430\u043a\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432 \u043a\u0430\u043d\u0430\u043b <code>out</code> \u0434\u043b\u044f \u0433\u043e\u0440\u0443\u0442\u0438\u043d\u044b \u0437\u0430\u043f\u0438\u0441\u0438.</li> <li>\u041f\u0440\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u043e\u0442\u0432\u0435\u0442\u0430 reader \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u0435\u0433\u043e \u043f\u043e <code>(Msg, Sync)</code> \u0438 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u043a\u043e\u043b\u0431\u044d\u043a.</li> </ol> <p>\u0416\u0438\u0437\u043d\u0435\u043d\u043d\u044b\u0439 \u0446\u0438\u043a\u043b:</p> <ul> <li><code>NewChannel(conn, config)</code> \u2014 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043a\u0430\u043d\u0430\u043b\u0430.</li> <li><code>Init()</code> \u2014 \u0437\u0430\u043f\u0443\u0441\u043a \u0433\u043e\u0440\u0443\u0442\u0438\u043d \u0447\u0442\u0435\u043d\u0438\u044f/\u0437\u0430\u043f\u0438\u0441\u0438.</li> <li><code>Shutdown()</code> \u2014 graceful shutdown \u0441 \u0434\u0432\u0443\u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0438\u043c handshake.</li> <li><code>Close()</code> \u2014 \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0435.</li> <li><code>Done()</code> \u2014 \u043a\u0430\u043d\u0430\u043b, \u0441\u0438\u0433\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u044e\u0449\u0438\u0439 \u043e \u043f\u043e\u043b\u043d\u043e\u043c \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0438.</li> </ul> <p>\u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438:</p> <ul> <li>\u041d\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u043c\u044b\u0439 ping/keepalive \u0447\u0435\u0440\u0435\u0437 <code>PingInterval</code>.</li> <li>Idle timeout \u0447\u0435\u0440\u0435\u0437 <code>IdleTimeout</code>.</li> <li>\u041b\u0438\u043c\u0438\u0442 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u043f\u0430\u043a\u0435\u0442\u0430 \u0447\u0435\u0440\u0435\u0437 <code>SizeLimit</code> (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 100 \u041c\u0411).</li> <li>\u041f\u0435\u0440\u0435\u0445\u0432\u0430\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u0447\u0435\u0440\u0435\u0437 <code>Hijack()</code>.</li> </ul>"},{"location":"ru/architecture/#pool","title":"Pool","text":"<p><code>Pool</code> \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c\u0438 Channel \u043a \u043e\u0434\u043d\u043e\u043c\u0443 \u0430\u0434\u0440\u0435\u0441\u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0430.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Pool                \u2502\n\u2502                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 Channel  \u2502  \u2502 Channel  \u2502 ... \u2502\n\u2502  \u2502    #0    \u2502  \u2502    #1    \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                  \u2502\n\u2502  Round-robin \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430        \u2502\n\u2502  \u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435  \u2502\n\u2502  Rate limiting (token bucket)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0438:</p> <ul> <li>\u0411\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430 \u2014 round-robin \u0447\u0435\u0440\u0435\u0437 <code>NextChannel()</code>.</li> <li>\u0410\u0432\u0442\u043e\u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u2014 \u0447\u0435\u0440\u0435\u0437 <code>BackgroundDialer</code> \u0441 \u043d\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u043c\u044b\u043c backoff.</li> <li>Rate limiting \u2014 \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0439 token bucket limiter \u0441 \u0440\u0435\u0436\u0438\u043c\u0430\u043c\u0438 shaping \u0438 policing.</li> <li>FailOnCutoff \u2014 \u043f\u0440\u0438 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0438 \u0432\u044b\u0437\u043e\u0432\u044b \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u044e\u0442\u0441\u044f \u043e\u0448\u0438\u0431\u043a\u043e\u0439, \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 \u043e\u043d\u043b\u0430\u0439\u043d-\u043a\u0430\u043d\u0430\u043b\u043e\u0432.</li> </ul>"},{"location":"ru/architecture/#server","title":"Server","text":"<p><code>Server</code> \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435 TCP-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u0438 \u0441\u043e\u0437\u0434\u0430\u0451\u0442 Channel \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e.</p> <pre><code>srv := &amp;iproto.Server{\n    ChannelConfig: &amp;iproto.ChannelConfig{\n        Handler: myHandler,\n    },\n}\nsrv.ListenAndServe(ctx, \"tcp\", \":3301\")\n</code></pre> <p>\u041f\u043e\u043b\u0435 <code>Accept</code> \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043d\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0442\u044c \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 Channel (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u0443\u043b\u044b \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u043e\u0432 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f).</p>"},{"location":"ru/architecture/#servemux","title":"ServeMux","text":"<p><code>ServeMux</code> \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \u043f\u0430\u043a\u0435\u0442\u044b \u043a \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0430\u043c \u043f\u043e <code>Header.Msg</code>:</p> <pre><code>mux := iproto.NewServeMux()\nmux.Handle(1, echoHandler)\nmux.Handle(2, timeHandler)\n</code></pre> <p>\u041f\u0440\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u043f\u0430\u043a\u0435\u0442\u0430 <code>ServeMux.ServeIProto</code> \u0438\u0449\u0435\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043f\u043e \u043a\u043e\u0434\u0443 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u0435\u0433\u043e.</p>"},{"location":"ru/architecture/#_4","title":"\u0421\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f","text":""},{"location":"ru/architecture/#little-endian","title":"\u0420\u0435\u0436\u0438\u043c \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (Little-Endian, \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430)","text":"\u0422\u0438\u043f \u0420\u0430\u0437\u043c\u0435\u0440 <code>uint8</code> / <code>int8</code> 1 \u0431\u0430\u0439\u0442 <code>uint16</code> / <code>int16</code> 2 \u0431\u0430\u0439\u0442\u0430 <code>uint32</code> / <code>int32</code> / <code>int</code> / <code>uint</code> 4 \u0431\u0430\u0439\u0442\u0430 <code>uint64</code> / <code>int64</code> 8 \u0431\u0430\u0439\u0442 <code>string</code> / <code>[]byte</code> 4-\u0431\u0430\u0439\u0442\u043d\u044b\u0439 \u043f\u0440\u0435\u0444\u0438\u043a\u0441 \u0434\u043b\u0438\u043d\u044b + \u0434\u0430\u043d\u043d\u044b\u0435 <code>struct</code> \u043f\u043e\u043b\u044f \u043a\u043e\u0434\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u043f\u043e \u043f\u043e\u0440\u044f\u0434\u043a\u0443 <code>slice</code> 4-\u0431\u0430\u0439\u0442\u043d\u044b\u0439 \u043f\u0440\u0435\u0444\u0438\u043a\u0441 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0430 + \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b"},{"location":"ru/architecture/#ber","title":"\u0420\u0435\u0436\u0438\u043c BER (\u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430)","text":"<p>BER-\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 7 \u0431\u0438\u0442 \u043d\u0430 \u0431\u0430\u0439\u0442, \u0441\u0442\u0430\u0440\u0448\u0438\u0439 \u0431\u0438\u0442 \u2014 \u0438\u043d\u0434\u0438\u043a\u0430\u0442\u043e\u0440 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u044f. \u041c\u0430\u043b\u0435\u043d\u044c\u043a\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0437\u0430\u043d\u0438\u043c\u0430\u044e\u0442 \u043c\u0435\u043d\u044c\u0448\u0435 \u0431\u0430\u0439\u0442:</p> <ul> <li><code>5</code> \u2192 <code>05</code> (1 \u0431\u0430\u0439\u0442)</li> <li><code>128</code> \u2192 <code>81 00</code> (2 \u0431\u0430\u0439\u0442\u0430)</li> <li><code>100000</code> \u2192 <code>86 8d 20</code> (3 \u0431\u0430\u0439\u0442\u0430)</li> </ul> <p>\u0422\u0435\u0433\u0438 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440 \u0434\u043b\u044f \u0441\u043c\u0435\u0448\u0438\u0432\u0430\u043d\u0438\u044f \u0440\u0435\u0436\u0438\u043c\u043e\u0432:</p> <pre><code>type Message struct {\n    Count uint32 `iproto:\"ber\"`  // BER-\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\n    Name  string                 // \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (LE fixed)\n}\n</code></pre>"},{"location":"ru/architecture/#syncutil","title":"syncutil","text":"<p>\u041f\u0440\u0438\u043c\u0438\u0442\u0438\u0432\u044b \u043a\u043e\u043d\u043a\u0443\u0440\u0435\u043d\u0442\u043d\u043e\u0441\u0442\u0438, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0435 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435 \u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e:</p> <ul> <li>TaskGroup \u2014 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0434\u043e N \u0437\u0430\u0434\u0430\u0447 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e. \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043a\u0430\u043d\u0430\u043b\u044b \u0441 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430\u043c\u0438.</li> <li>TaskRunner \u2014 \u0437\u0430\u043f\u0443\u0441\u043a \u0440\u043e\u0432\u043d\u043e \u043e\u0434\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0438; \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0449\u0438\u0445 \u043f\u043e\u0434\u043f\u0438\u0441\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043d\u0430 \u043e\u0434\u0438\u043d \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442.</li> <li>Throttle \u2014 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 \u0447\u0430\u0441\u0442\u043e\u0442\u044b \u0432\u044b\u0437\u043e\u0432\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 (\u043d\u0435 \u0447\u0430\u0449\u0435 \u043e\u0434\u043d\u043e\u0433\u043e \u0440\u0430\u0437\u0430 \u0437\u0430 \u043f\u0435\u0440\u0438\u043e\u0434).</li> <li>Multitask / Every / Each \u2014 \u0437\u0430\u043f\u0443\u0441\u043a N \u0437\u0430\u0434\u0430\u0447 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u043e \u0441 \u043e\u0442\u043c\u0435\u043d\u043e\u0439.</li> </ul>"},{"location":"ru/contributing/","title":"\u0423\u0447\u0430\u0441\u0442\u0438\u0435 \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435","text":"<p>\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u0438\u043d\u0442\u0435\u0440\u0435\u0441 \u043a \u043f\u0440\u043e\u0435\u043a\u0442\u0443! \u042d\u0442\u043e\u0442 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0443\u0447\u0430\u0441\u0442\u0438\u044f.</p>"},{"location":"ru/contributing/#_2","title":"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0430\u0445","text":"<ul> <li>\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 issues, \u0447\u0442\u043e\u0431\u044b \u0438\u0437\u0431\u0435\u0436\u0430\u0442\u044c \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f.</li> <li>\u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u043d\u043e\u0432\u044b\u0439 issue \u0441 \u0447\u0451\u0442\u043a\u0438\u043c \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u043c \u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435\u043c.</li> <li>\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e Go, \u041e\u0421 \u0438 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u043c\u044b\u0439 \u043f\u0440\u0438\u043c\u0435\u0440.</li> </ul>"},{"location":"ru/contributing/#_3","title":"\u041f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u043f\u043e \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u044e","text":"<ul> <li>\u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 issue \u0441 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435\u043c \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u044f \u0438 \u0435\u0433\u043e \u043c\u043e\u0442\u0438\u0432\u0430\u0446\u0438\u0435\u0439.</li> <li>\u0414\u043b\u044f \u0437\u043d\u0430\u0447\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u043e\u0431\u0441\u0443\u0434\u0438\u0442\u0435 \u043f\u043e\u0434\u0445\u043e\u0434 \u0434\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 PR.</li> </ul>"},{"location":"ru/contributing/#_4","title":"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u044f","text":"<ol> <li>Go 1.24+ \u2014 https://go.dev/dl/</li> <li>golangci-lint \u2014 https://golangci-lint.run/welcome/install/</li> <li>make \u2014 \u0434\u043b\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0446\u0435\u043b\u0435\u0439</li> </ol> <pre><code>git clone https://github.com/Educentr/go-iproto.git\ncd go-iproto\nmake test\nmake lint\n</code></pre>"},{"location":"ru/contributing/#_5","title":"\u0421\u0442\u0438\u043b\u044c \u043a\u043e\u0434\u0430","text":"<ul> <li>\u0424\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435: <code>gofmt</code> \u0438 <code>goimports</code>.</li> <li>\u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0439\u0442\u0435 <code>make lint</code> \u043f\u0435\u0440\u0435\u0434 \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u043c.</li> <li>\u0421\u043b\u0435\u0434\u0443\u0439\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c \u0441\u043e\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u044f\u043c \u043f\u0440\u043e\u0435\u043a\u0442\u0430.</li> </ul>"},{"location":"ru/contributing/#pull-request","title":"\u041f\u0440\u043e\u0446\u0435\u0441\u0441 Pull Request","text":"<ol> <li>\u0421\u0434\u0435\u043b\u0430\u0439\u0442\u0435 \u0444\u043e\u0440\u043a \u0438 \u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0432\u0435\u0442\u043a\u0443 \u0434\u043b\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439.</li> <li>\u041a\u043e\u043c\u043c\u0438\u0442\u044b \u0441 \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u043c\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u043c\u0438.</li> <li><code>make test</code> \u0438 <code>make lint</code> \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442\u044c.</li> <li>\u041e\u0442\u043f\u0440\u0430\u0432\u044c\u0442\u0435 PR \u0432 \u0432\u0435\u0442\u043a\u0443 <code>main</code>.</li> <li>\u041e\u043f\u0438\u0448\u0438\u0442\u0435, \u0447\u0442\u043e \u0434\u0435\u043b\u0430\u0435\u0442 PR, \u0438 \u0443\u043a\u0430\u0436\u0438\u0442\u0435 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 issues.</li> </ol>"},{"location":"ru/contributing/#_6","title":"\u041b\u0438\u0446\u0435\u043d\u0437\u0438\u044f","text":"<p>\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f, \u0432\u044b \u0441\u043e\u0433\u043b\u0430\u0448\u0430\u0435\u0442\u0435\u0441\u044c \u0441 \u0438\u0445 \u043b\u0438\u0446\u0435\u043d\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u043f\u043e MIT License.</p>"},{"location":"ru/examples/","title":"\u041f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u0412\u0441\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435 <code>examples/</code> \u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u044e\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 <code>go run</code>.</p>"},{"location":"ru/examples/#echo-","title":"Echo-\u0441\u0435\u0440\u0432\u0435\u0440","text":"<p>\u0411\u0430\u0437\u043e\u0432\u044b\u0439 echo-\u0441\u0435\u0440\u0432\u0435\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435.</p> <pre><code>go run ./examples/echo\n</code></pre> <pre><code>// \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0430: \u044d\u0445\u043e-\u043e\u0442\u0432\u0435\u0442.\nhandler := iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n    _ = c.Send(ctx, iproto.ResponseTo(p, p.Data))\n})\n\nsrv := &amp;iproto.Server{\n    ChannelConfig: &amp;iproto.ChannelConfig{Handler: handler},\n}\ngo srv.Serve(ctx, ln)\n\n// \u041a\u043b\u0438\u0435\u043d\u0442: \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435.\npool, _ := iproto.Dial(ctx, \"tcp\", addr, &amp;iproto.PoolConfig{Size: 1})\ndata := iproto.PackString(nil, \"Hello, iproto!\", iproto.ModeDefault)\nresp, _ := pool.Call(ctx, 1, data)\n</code></pre>"},{"location":"ru/examples/#_2","title":"\u041f\u0443\u043b \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439","text":"<p>\u041d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0433\u043e\u0440\u0443\u0442\u0438\u043d \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0442 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0447\u0435\u0440\u0435\u0437 \u043f\u0443\u043b \u0438\u0437 4 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439. \u0421\u0435\u0440\u0432\u0435\u0440 \u0443\u0434\u0432\u0430\u0438\u0432\u0430\u0435\u0442 \u043a\u0430\u0436\u0434\u044b\u0439 <code>uint32</code>.</p> <pre><code>go run ./examples/pool\n</code></pre> <pre><code>// \u0421\u0435\u0440\u0432\u0435\u0440: \u0443\u0434\u0432\u043e\u0435\u043d\u0438\u0435 \u0447\u0438\u0441\u043b\u0430.\nhandler := iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n    var in uint32\n    iproto.UnpackUint32(bytes.NewReader(p.Data), &amp;in, 0)\n    _ = c.Send(ctx, iproto.ResponseTo(p, iproto.PackUint32(nil, in*2, 0)))\n})\n\n// \u041f\u0443\u043b \u0438\u0437 4 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439, 8 \u043a\u043e\u043d\u043a\u0443\u0440\u0435\u043d\u0442\u043d\u044b\u0445 \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432.\npool, _ := iproto.Dial(ctx, \"tcp\", addr, &amp;iproto.PoolConfig{Size: 4})\n\nvar wg sync.WaitGroup\nfor w := range 8 {\n    wg.Add(1)\n    go func(id int) {\n        defer wg.Done()\n        for i := range uint32(100) {\n            resp, _ := pool.Call(ctx, 1, iproto.PackUint32(nil, i, 0))\n            // \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430...\n        }\n    }(w)\n}\nwg.Wait()\nfmt.Println(\"\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430:\", pool.Stats())\n</code></pre>"},{"location":"ru/examples/#_3","title":"\u0411\u0438\u043d\u0430\u0440\u043d\u0430\u044f \u0441\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f","text":"<p>\u0423\u043f\u0430\u043a\u043e\u0432\u043a\u0430 \u0438 \u0440\u0430\u0441\u043f\u0430\u043a\u043e\u0432\u043a\u0430 \u043f\u0440\u0438\u043c\u0438\u0442\u0438\u0432\u043d\u044b\u0445 \u0442\u0438\u043f\u043e\u0432, BER-\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u0441 \u0442\u0435\u0433\u0430\u043c\u0438.</p> <pre><code>go run ./examples/packing\n</code></pre> <pre><code>// \u041f\u0440\u0438\u043c\u0438\u0442\u0438\u0432\u043d\u044b\u0435 \u0442\u0438\u043f\u044b.\ndata, _ := iproto.Pack(uint32(258))\n// -&gt; 02010000\n\n// BER-\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 (\u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430).\ndata, _ = iproto.PackBER(uint32(128))\n// -&gt; 8100\n\n// \u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0441\u043e \u0441\u043c\u0435\u0448\u0430\u043d\u043d\u044b\u043c\u0438 \u0440\u0435\u0436\u0438\u043c\u0430\u043c\u0438.\ntype Message struct {\n    Count uint32 `iproto:\"ber\"`\n    Name  string\n}\ndata, _ = iproto.Pack(Message{Count: 258, Name: \"world\"})\n\nvar msg Message\niproto.Unpack(data, &amp;msg)\n</code></pre>"},{"location":"ru/examples/#servemux","title":"\u041c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044f ServeMux","text":"<p>\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u043e\u0432 \u0434\u043b\u044f \u0440\u0430\u0437\u043d\u044b\u0445 \u043a\u043e\u0434\u043e\u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439. \u041a\u043b\u0438\u0435\u043d\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u043a\u0430\u0436\u0434\u044b\u0439 \u0438\u0437 \u043d\u0438\u0445.</p> <pre><code>go run ./examples/mux\n</code></pre> <pre><code>mux := iproto.NewServeMux()\n\n// Echo-\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043d\u0430 \u043a\u043e\u0434\u0435 1.\nmux.Handle(1, iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n    _ = c.Send(ctx, iproto.ResponseTo(p, p.Data))\n}))\n\n// Time-\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043d\u0430 \u043a\u043e\u0434\u0435 2.\nmux.Handle(2, iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n    now := time.Now().Format(time.RFC3339)\n    _ = c.Send(ctx, iproto.ResponseTo(p, iproto.PackString(nil, now, iproto.ModeDefault)))\n}))\n\nsrv := &amp;iproto.Server{\n    ChannelConfig: &amp;iproto.ChannelConfig{Handler: mux},\n}\n\n// \u041a\u043b\u0438\u0435\u043d\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u0440\u0430\u0437\u043d\u044b\u0435 \u043c\u0435\u0442\u043e\u0434\u044b.\npool, _ := iproto.Dial(ctx, \"tcp\", addr, nil)\nresp, _ := pool.Call(ctx, 1, echoData)   // -&gt; echo-\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\nresp, _ = pool.Call(ctx, 2, nil)          // -&gt; time-\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\n</code></pre>"},{"location":"ru/getting-started/","title":"\u0411\u044b\u0441\u0442\u0440\u044b\u0439 \u0441\u0442\u0430\u0440\u0442","text":""},{"location":"ru/getting-started/#_2","title":"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430","text":"<pre><code>go get github.com/Educentr/go-iproto\n</code></pre> <p>\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f Go 1.24 \u0438\u043b\u0438 \u043d\u043e\u0432\u0435\u0435.</p>"},{"location":"ru/getting-started/#_3","title":"\u041f\u0435\u0440\u0432\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440","text":"<p>\u041f\u0440\u043e\u0441\u0442\u043e\u0439 echo-\u0441\u0435\u0440\u0432\u0435\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435:</p> <pre><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n\n    \"github.com/Educentr/go-iproto/iproto\"\n)\n\nfunc main() {\n    handler := iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n        _ = c.Send(ctx, iproto.ResponseTo(p, p.Data))\n    })\n\n    log.Fatal(iproto.ListenAndServe(context.Background(), \"tcp\", \":3301\", handler))\n}\n</code></pre>"},{"location":"ru/getting-started/#_4","title":"\u041f\u0435\u0440\u0432\u044b\u0439 \u043a\u043b\u0438\u0435\u043d\u0442","text":"<p>\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430:</p> <pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"log\"\n\n    \"github.com/Educentr/go-iproto/iproto\"\n)\n\nfunc main() {\n    pool, err := iproto.Dial(context.Background(), \"tcp\", \"127.0.0.1:3301\", nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer pool.Close()\n\n    resp, err := pool.Call(context.Background(), 1, []byte(\"hello\"))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"\u043e\u0442\u0432\u0435\u0442: %s\\n\", resp)\n}\n</code></pre>"},{"location":"ru/getting-started/#_5","title":"\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u0430\u043a\u0435\u0442\u043e\u0432","text":"\u041f\u0430\u043a\u0435\u0442 \u041f\u0443\u0442\u044c \u0438\u043c\u043f\u043e\u0440\u0442\u0430 \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 iproto <code>github.com/Educentr/go-iproto/iproto</code> \u042f\u0434\u0440\u043e \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0430: Channel, Pool, Server, ServeMux, Pack/Unpack netutil <code>github.com/Educentr/go-iproto/netutil</code> Dialer \u0441 retry/backoff, BackgroundDialer syncutil <code>github.com/Educentr/go-iproto/syncutil</code> TaskGroup, TaskRunner, Throttle, Multitask"},{"location":"ru/getting-started/#_6","title":"\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0446\u0438\u0438","text":"<ul> <li>Channel \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0434\u043d\u0438\u043c TCP-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435\u043c. \u041e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u0447\u0442\u0435\u043d\u0438\u0435/\u0437\u0430\u043f\u0438\u0441\u044c \u043f\u0430\u043a\u0435\u0442\u043e\u0432, ping/keepalive \u0438 \u043a\u043e\u0440\u0440\u0435\u043b\u044f\u0446\u0438\u044e \u0437\u0430\u043f\u0440\u043e\u0441-\u043e\u0442\u0432\u0435\u0442 \u0447\u0435\u0440\u0435\u0437 <code>Sync</code> ID.</li> <li>Pool \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c\u0438 Channel \u043a \u043e\u0434\u043d\u043e\u043c\u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0443. \u0411\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0438 (round-robin), \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435, \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0439 rate limiting.</li> <li>Server \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435 TCP-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u0438 \u0441\u043e\u0437\u0434\u0430\u0451\u0442 Channel \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e.</li> <li>ServeMux \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \u043f\u0430\u043a\u0435\u0442\u044b \u043a \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0430\u043c \u043f\u043e \u043a\u043e\u0434\u0443 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f (<code>Header.Msg</code>).</li> <li>Pack/Unpack \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442 \u0431\u0438\u043d\u0430\u0440\u043d\u0443\u044e \u0441\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044e. \u0426\u0435\u043b\u044b\u0435 \u0447\u0438\u0441\u043b\u0430 \u2014 little-endian \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e, \u0441 \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u043c BER-\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c (\u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430).</li> </ul>"},{"location":"ru/getting-started/#_7","title":"\u0414\u0430\u043b\u0435\u0435","text":"<ul> <li>\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u2014 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0430</li> <li>API-\u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a \u2014 \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0430\u044f \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f API</li> <li>\u041f\u0440\u0438\u043c\u0435\u0440\u044b \u2014 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c\u044b\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u044b</li> </ul>"},{"location":"ru/","title":"go-iproto","text":"<p>Go-\u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0431\u0438\u043d\u0430\u0440\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0430 iproto \u2014 \u043b\u0435\u0433\u043a\u043e\u0432\u0435\u0441\u043d\u044b\u0439 \u0432\u044b\u0441\u043e\u043a\u043e\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0444\u0440\u0435\u0439\u043c\u0432\u043e\u0440\u043a \u0434\u043b\u044f \u0431\u0438\u043d\u0430\u0440\u043d\u043e\u0433\u043e RPC.</p>"},{"location":"ru/#_1","title":"\u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438","text":"<ul> <li>Channel \u2014 \u043e\u0434\u043d\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u043a\u043e\u0440\u0440\u0435\u043b\u044f\u0446\u0438\u0435\u0439 \u0437\u0430\u043f\u0440\u043e\u0441-\u043e\u0442\u0432\u0435\u0442, ping/keepalive, graceful shutdown</li> <li>Pool \u2014 \u043f\u0443\u043b \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u0441 \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u043e\u0439, \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c \u0438 rate limiting</li> <li>Server / ServeMux \u2014 \u043f\u0440\u0438\u0451\u043c \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u0441 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0435\u0439 \u043f\u043e \u043a\u043e\u0434\u0443 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f</li> <li>Pack / Unpack \u2014 \u0431\u0438\u043d\u0430\u0440\u043d\u0430\u044f \u0441\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0446\u0435\u043b\u044b\u0445 \u0447\u0438\u0441\u0435\u043b, \u0441\u0442\u0440\u043e\u043a, \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440 \u0441 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u043e\u0439 BER</li> <li>netutil \u2014 Dialer \u0441 retry/backoff \u0438 \u0444\u043e\u043d\u043e\u0432\u044b\u043c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c</li> <li>syncutil \u2014 \u043f\u0440\u0438\u043c\u0438\u0442\u0438\u0432\u044b \u043a\u043e\u043d\u043a\u0443\u0440\u0435\u043d\u0442\u043d\u043e\u0441\u0442\u0438: TaskGroup, TaskRunner, Throttle, Multitask</li> </ul>"},{"location":"ru/#_2","title":"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430","text":"<pre><code>go get github.com/Educentr/go-iproto\n</code></pre> <p>\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f Go 1.24+.</p>"},{"location":"ru/#_3","title":"\u0411\u044b\u0441\u0442\u0440\u044b\u0439 \u043f\u0440\u0438\u043c\u0435\u0440","text":"<pre><code>// \u0421\u0435\u0440\u0432\u0435\u0440\nhandler := iproto.HandlerFunc(func(ctx context.Context, c iproto.Conn, p iproto.Packet) {\n    _ = c.Send(ctx, iproto.ResponseTo(p, p.Data))\n})\niproto.ListenAndServe(ctx, \"tcp\", \":3301\", handler)\n\n// \u041a\u043b\u0438\u0435\u043d\u0442\npool, _ := iproto.Dial(ctx, \"tcp\", \"127.0.0.1:3301\", nil)\nresp, _ := pool.Call(ctx, 1, []byte(\"hello\"))\n</code></pre>"},{"location":"ru/#_4","title":"\u0421\u0441\u044b\u043b\u043a\u0438","text":"<ul> <li>\u0411\u044b\u0441\u0442\u0440\u044b\u0439 \u0441\u0442\u0430\u0440\u0442 \u2014 \u043f\u043e\u0448\u0430\u0433\u043e\u0432\u043e\u0435 \u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0441\u0442\u0432\u043e</li> <li>\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u2014 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0430</li> <li>API-\u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a \u2014 \u0442\u0438\u043f\u044b, \u0444\u0443\u043d\u043a\u0446\u0438\u0438, \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u044b</li> <li>\u041f\u0440\u0438\u043c\u0435\u0440\u044b \u2014 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c\u044b\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u043a\u043e\u0434\u0430</li> <li>GitHub</li> <li>pkg.go.dev</li> </ul>"},{"location":"ru/api/iproto/","title":"\u041f\u0430\u043a\u0435\u0442 iproto","text":"<p><code>import \"github.com/Educentr/go-iproto/iproto\"</code></p> <p>\u041f\u043e\u043b\u043d\u044b\u0439 API-\u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a: pkg.go.dev</p>"},{"location":"ru/api/iproto/#_1","title":"\u0422\u0438\u043f\u044b","text":""},{"location":"ru/api/iproto/#header","title":"Header","text":"<pre><code>type Header struct {\n    Msg  uint32 // \u041a\u043e\u0434 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f/\u043c\u0435\u0442\u043e\u0434\u0430\n    Len  uint32 // \u0414\u043b\u0438\u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u0445\n    Sync uint32 // ID \u043a\u043e\u0440\u0440\u0435\u043b\u044f\u0446\u0438\u0438 \u0437\u0430\u043f\u0440\u043e\u0441-\u043e\u0442\u0432\u0435\u0442\n}\n</code></pre>"},{"location":"ru/api/iproto/#channel","title":"Channel","text":"<p>\u041e\u0434\u043d\u043e iproto-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435.</p> <pre><code>func NewChannel(conn net.Conn, config *ChannelConfig) *Channel\nfunc RunChannel(conn net.Conn, config *ChannelConfig) (*Channel, error)\n</code></pre> <p>\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043c\u0435\u0442\u043e\u0434\u044b:</p> \u041c\u0435\u0442\u043e\u0434 \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>Init()</code> \u0417\u0430\u043f\u0443\u0441\u043a \u0433\u043e\u0440\u0443\u0442\u0438\u043d \u0447\u0442\u0435\u043d\u0438\u044f/\u0437\u0430\u043f\u0438\u0441\u0438 <code>Call(ctx, msg, data)</code> \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430, \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0435 \u043e\u0442\u0432\u0435\u0442\u0430 <code>Notify(ctx, msg, data)</code> \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f (fire-and-forget) <code>Send(ctx, packet)</code> \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0441\u044b\u0440\u043e\u0433\u043e \u043f\u0430\u043a\u0435\u0442\u0430 <code>Shutdown()</code> Graceful shutdown <code>Close()</code> \u041d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0435 <code>Done()</code> \u041a\u0430\u043d\u0430\u043b \u0441\u0438\u0433\u043d\u0430\u043b\u0430 \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u044f <code>Stats()</code> \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c <code>ChannelStats</code> <code>Hijack()</code> \u041f\u0435\u0440\u0435\u0445\u0432\u0430\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"},{"location":"ru/api/iproto/#channelconfig","title":"ChannelConfig","text":"\u041f\u043e\u043b\u0435 \u0422\u0438\u043f \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>Handler</code> <code>Handler</code> \u2014 \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 <code>RequestTimeout</code> <code>time.Duration</code> 5\u0441 \u0422\u0430\u0439\u043c\u0430\u0443\u0442 Call <code>NoticeTimeout</code> <code>time.Duration</code> 1\u0441 \u0422\u0430\u0439\u043c\u0430\u0443\u0442 Notify <code>PingInterval</code> <code>time.Duration</code> 1\u043c \u0418\u043d\u0442\u0435\u0440\u0432\u0430\u043b keepalive <code>IdleTimeout</code> <code>time.Duration</code> 0 \u0422\u0430\u0439\u043c\u0430\u0443\u0442 \u043d\u0435\u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f <code>ShutdownTimeout</code> <code>time.Duration</code> 5\u0441 \u0422\u0430\u0439\u043c\u0430\u0443\u0442 handshake shutdown <code>SizeLimit</code> <code>uint32</code> 1e8 \u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u043f\u0430\u043a\u0435\u0442\u0430 <code>WriteQueueSize</code> <code>int</code> 50 \u0420\u0430\u0437\u043c\u0435\u0440 \u0431\u0443\u0444\u0435\u0440\u0430 \u0432\u044b\u0432\u043e\u0434\u0430 <code>Init</code> <code>func(context.Context, *Channel) error</code> nil \u041a\u043e\u043b\u0431\u044d\u043a \u043f\u043e\u0441\u043b\u0435 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438"},{"location":"ru/api/iproto/#pool","title":"Pool","text":"<p>\u041f\u0443\u043b \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u043a \u043e\u0434\u043d\u043e\u043c\u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0443.</p> <pre><code>func Dial(ctx context.Context, network, addr string, config *PoolConfig) (*Pool, error)\nfunc NewPool(network, addr string, config *PoolConfig) *Pool\n</code></pre> <p>\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043c\u0435\u0442\u043e\u0434\u044b:</p> \u041c\u0435\u0442\u043e\u0434 \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>Init(ctx)</code> \u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f <code>InitAll(ctx)</code> \u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0432\u0441\u0435\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 <code>Call(ctx, msg, data)</code> \u0412\u044b\u0437\u043e\u0432 \u0447\u0435\u0440\u0435\u0437 \u043b\u044e\u0431\u043e\u0439 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0439 \u043a\u0430\u043d\u0430\u043b <code>Notify(ctx, msg, data)</code> \u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 \u043b\u044e\u0431\u043e\u0439 \u043a\u0430\u043d\u0430\u043b <code>NextChannel(ctx)</code> \u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u043a\u0430\u043d\u0430\u043b (round-robin) <code>Online()</code> \u0421\u043f\u0438\u0441\u043e\u043a \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u043a\u0430\u043d\u0430\u043b\u043e\u0432 <code>Stats()</code> \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c <code>PoolStats</code> <code>Shutdown()</code> Graceful shutdown <code>Close()</code> \u041d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0435"},{"location":"ru/api/iproto/#poolconfig","title":"PoolConfig","text":"\u041f\u043e\u043b\u0435 \u0422\u0438\u043f \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>Size</code> <code>int</code> 1 \u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 <code>ChannelConfig</code> <code>*ChannelConfig</code> \u2014 \u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043a\u0430\u043d\u0430\u043b\u0430 <code>ConnectTimeout</code> <code>time.Duration</code> 1\u0441 \u041c\u0430\u043a\u0441. \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0433\u043e \u043a\u0430\u043d\u0430\u043b\u0430 <code>RedialInterval</code> <code>time.Duration</code> 10\u043c\u0441 \u041d\u0430\u0447\u0430\u043b\u044c\u043d\u0430\u044f \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0430 \u043f\u043e\u0432\u0442\u043e\u0440\u0430 <code>RedialTimeout</code> <code>time.Duration</code> 1\u0447 \u041c\u0430\u043a\u0441. \u043e\u0431\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u0434\u043e\u0437\u0432\u043e\u043d\u0430 <code>RedialForever</code> <code>bool</code> false \u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0442\u0430\u0439\u043c\u0430\u0443\u0442 \u0434\u043e\u0437\u0432\u043e\u043d\u0430 <code>FailOnCutoff</code> <code>bool</code> false \u0411\u044b\u0441\u0442\u0440\u044b\u0439 \u043e\u0442\u043a\u0430\u0437 \u043f\u0440\u0438 \u043e\u0444\u0444\u043b\u0430\u0439\u043d\u0435 <code>RateLimit</code> <code>rate.Limit</code> 0 \u0421\u043a\u043e\u0440\u043e\u0441\u0442\u044c token bucket <code>RateBurst</code> <code>int</code> 0 \u0412\u0441\u043f\u043b\u0435\u0441\u043a token bucket (0 = \u0432\u044b\u043a\u043b.) <code>RateWait</code> <code>bool</code> false Shaping (true) \u0438\u043b\u0438 policing (false)"},{"location":"ru/api/iproto/#pack-unpack","title":"Pack / Unpack","text":"<pre><code>func Pack(value ...any) ([]byte, error)\nfunc PackBER(value ...any) ([]byte, error)\nfunc Append(data []byte, value ...any) ([]byte, error)\nfunc Unpack(data []byte, value ...any) ([]byte, error)\nfunc UnpackBER(data []byte, value ...any) ([]byte, error)\n</code></pre> <p>\u0424\u0443\u043d\u043a\u0446\u0438\u0438 \u043f\u043e \u0442\u0438\u043f\u0430\u043c:</p> <pre><code>func PackUint8(w []byte, v uint8, mode PackMode) []byte\nfunc PackUint16(w []byte, v uint16, mode PackMode) []byte\nfunc PackUint32(w []byte, v uint32, mode PackMode) []byte\nfunc PackUint64(w []byte, v uint64, mode PackMode) []byte\nfunc PackString(w []byte, v string, mode PackMode) []byte\nfunc PackBytes(w []byte, v []byte, mode PackMode) []byte\n</code></pre> <p>\u0418\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u044b \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0439 \u0441\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438:</p> <pre><code>type Packer interface {\n    IprotoPack(w []byte, mode PackMode) ([]byte, error)\n}\n\ntype Unpacker interface {\n    IprotoUnpack(r *bytes.Reader, mode PackMode) error\n}\n</code></pre>"},{"location":"ru/api/iproto/#_2","title":"\u041e\u0448\u0438\u0431\u043a\u0438","text":"\u041f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>ErrTimeout</code> \u0417\u0430\u043f\u0440\u043e\u0441 \u043f\u0440\u0435\u0432\u044b\u0441\u0438\u043b \u0442\u0430\u0439\u043c\u0430\u0443\u0442 <code>ErrDroppedConn</code> \u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0431\u044b\u043b\u043e \u0441\u0431\u0440\u043e\u0448\u0435\u043d\u043e <code>ErrStopped</code> \u041a\u0430\u043d\u0430\u043b/\u043f\u0443\u043b \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d <code>ErrHijacked</code> \u041a\u0430\u043d\u0430\u043b \u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0447\u0435\u043d <code>ErrCutoff</code> \u041f\u0443\u043b \u043e\u0444\u0444\u043b\u0430\u0439\u043d (\u0440\u0435\u0436\u0438\u043c FailOnCutoff) <code>ErrPoolFull</code> \u041d\u0435\u0442 \u043c\u0435\u0441\u0442\u0430 \u0432 \u043f\u0443\u043b\u0435 <code>ErrNoChannel</code> \u0422\u0430\u0439\u043c\u0430\u0443\u0442 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u043a\u0430\u043d\u0430\u043b\u0430 <code>ErrPolicied</code> \u041e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u043e \u043b\u0438\u043c\u0438\u0442\u043e\u043c \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0438"},{"location":"ru/api/iproto/#_3","title":"\u0423\u0442\u0438\u043b\u0438\u0442\u044b","text":"<pre><code>func ResponseTo(p Packet, b []byte) Packet\nfunc CopyChannelConfig(c *ChannelConfig) *ChannelConfig\nfunc CopyPoolConfig(c *PoolConfig) *PoolConfig\n</code></pre>"},{"location":"ru/api/netutil/","title":"\u041f\u0430\u043a\u0435\u0442 netutil","text":"<p><code>import \"github.com/Educentr/go-iproto/netutil\"</code></p> <p>\u041f\u043e\u043b\u043d\u044b\u0439 API-\u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a: pkg.go.dev</p>"},{"location":"ru/api/netutil/#dialer","title":"Dialer","text":"<p><code>Dialer</code> \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 TCP-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u043c\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0430\u043c\u0438 \u0438 \u044d\u043a\u0441\u043f\u043e\u043d\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u043c backoff.</p> <pre><code>type Dialer struct {\n    Network         string\n    Addr            string\n    Timeout         time.Duration        // \u0422\u0430\u0439\u043c\u0430\u0443\u0442 \u043e\u0434\u043d\u043e\u0439 \u043f\u043e\u043f\u044b\u0442\u043a\u0438\n    LoopInterval    time.Duration        // \u041d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u0439 backoff (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 50\u043c\u0441)\n    MaxLoopInterval time.Duration        // \u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 backoff\n    NetDial         func(ctx, net, addr) (net.Conn, error)\n    OnAttempt       func(err error)      // \u0412\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u0441\u043b\u0435 \u043a\u0430\u0436\u0434\u043e\u0439 \u043f\u043e\u043f\u044b\u0442\u043a\u0438\n    Logf            func(string, ...any)\n    Debugf          func(string, ...any)\n}\n</code></pre> <p>\u041c\u0435\u0442\u043e\u0434\u044b:</p> \u041c\u0435\u0442\u043e\u0434 \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>Dial(ctx) (net.Conn, error)</code> \u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0441 \u043f\u043e\u0432\u0442\u043e\u0440\u0430\u043c\u0438 \u0434\u043e \u0443\u0441\u043f\u0435\u0445\u0430 \u0438\u043b\u0438 \u043e\u0442\u043c\u0435\u043d\u044b \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430"},{"location":"ru/api/netutil/#backgrounddialer","title":"BackgroundDialer","text":"<p><code>BackgroundDialer</code> \u043e\u0431\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u0435\u0442 <code>Dialer</code> \u0434\u043b\u044f \u043a\u043e\u043d\u043a\u0443\u0440\u0435\u043d\u0442\u043d\u043e\u0433\u043e \u0444\u043e\u043d\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f. \u041d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0449\u0438\u0445 \u043c\u043e\u0433\u0443\u0442 \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u043e\u0434\u043d\u0443 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.</p> <pre><code>type BackgroundDialer struct {\n    Dialer     *Dialer\n    TaskGroup  *syncutil.TaskGroup\n    TaskRunner *syncutil.TaskRunner\n}\n</code></pre> <p>\u041c\u0435\u0442\u043e\u0434\u044b:</p> \u041c\u0435\u0442\u043e\u0434 \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>Dial(ctx, callback) &lt;-chan error</code> \u0417\u0430\u043f\u0443\u0441\u043a \u0438\u043b\u0438 \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043a \u0444\u043e\u043d\u043e\u0432\u043e\u043c\u0443 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044e <code>Cancel()</code> \u041e\u0442\u043c\u0435\u043d\u0430 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f <code>SetDeadline(t time.Time)</code> \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0430\u0431\u0441\u043e\u043b\u044e\u0442\u043d\u043e\u0433\u043e \u0434\u0435\u0434\u043b\u0430\u0439\u043d\u0430 <code>SetDeadlineAtLeast(t time.Time) time.Time</code> \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0434\u0435\u0434\u043b\u0430\u0439\u043d\u0430, \u0435\u0441\u043b\u0438 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0440\u0430\u043d\u044c\u0448\u0435"},{"location":"ru/api/netutil/#_1","title":"\u041f\u0440\u0438\u043c\u0435\u0440 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f","text":"<pre><code>d := &amp;netutil.BackgroundDialer{\n    Dialer: &amp;netutil.Dialer{\n        Network: \"tcp\",\n        Addr:    \"127.0.0.1:3301\",\n        Timeout: 5 * time.Second,\n    },\n    TaskRunner: &amp;syncutil.TaskRunner{},\n}\n\ndone := d.Dial(ctx, func(conn net.Conn, err error) {\n    if err != nil {\n        log.Fatal(err)\n    }\n    // \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 conn\n})\n\n&lt;-done\n</code></pre>"},{"location":"ru/api/syncutil/","title":"\u041f\u0430\u043a\u0435\u0442 syncutil","text":"<p><code>import \"github.com/Educentr/go-iproto/syncutil\"</code></p> <p>\u041f\u043e\u043b\u043d\u044b\u0439 API-\u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a: pkg.go.dev</p>"},{"location":"ru/api/syncutil/#taskgroup","title":"TaskGroup","text":"<p>\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0434\u043e N \u043a\u043e\u043d\u043a\u0443\u0440\u0435\u043d\u0442\u043d\u044b\u0445 \u0437\u0430\u0434\u0430\u0447. \u0421\u043b\u043e\u0442\u044b \u043f\u0435\u0440\u0435\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u043f\u043e \u043c\u0435\u0440\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f.</p> <pre><code>type TaskGroup struct {\n    N    int    // \u041c\u0430\u043a\u0441. \u043a\u043e\u043d\u043a\u0443\u0440\u0435\u043d\u0442\u043d\u044b\u0445 \u0437\u0430\u0434\u0430\u0447 (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 1)\n    Goer GoerFn // \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u0437\u0430\u043f\u0443\u0441\u043a \u0433\u043e\u0440\u0443\u0442\u0438\u043d (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)\n}\n</code></pre> <p>\u041c\u0435\u0442\u043e\u0434\u044b:</p> \u041c\u0435\u0442\u043e\u0434 \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>Do(ctx, n, task) []&lt;-chan error</code> \u0417\u0430\u043f\u0443\u0441\u043a \u0434\u043e n \u0437\u0430\u0434\u0430\u0447; \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043a\u0430\u043d\u0430\u043b\u044b \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 <code>Cancel()</code> \u041e\u0442\u043c\u0435\u043d\u0430 \u0432\u0441\u0435\u0445 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0449\u0438\u0445\u0441\u044f \u0437\u0430\u0434\u0430\u0447"},{"location":"ru/api/syncutil/#_1","title":"\u041f\u0440\u0438\u043c\u0435\u0440","text":"<pre><code>tg := &amp;syncutil.TaskGroup{N: 4}\n\nresults := tg.Do(ctx, 4, func(ctx context.Context, i int) error {\n    // \u0437\u0430\u0434\u0430\u0447\u0430 i \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u043a\u043e\u043d\u043a\u0443\u0440\u0435\u043d\u0442\u043d\u043e\n    return nil\n})\n\nfor _, ch := range results {\n    if err := &lt;-ch; err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>"},{"location":"ru/api/syncutil/#taskrunner","title":"TaskRunner","text":"<p>\u0417\u0430\u043f\u0443\u0441\u043a \u0440\u043e\u0432\u043d\u043e \u043e\u0434\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0438. \u041d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0449\u0438\u0445 \u043f\u043e\u0434\u043f\u0438\u0441\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043d\u0430 \u043e\u0434\u0438\u043d \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442.</p> <pre><code>type TaskRunner struct{}\n</code></pre> <p>\u041c\u0435\u0442\u043e\u0434\u044b:</p> \u041c\u0435\u0442\u043e\u0434 \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>Do(ctx, task) &lt;-chan error</code> \u0417\u0430\u043f\u0443\u0441\u043a \u0437\u0430\u0434\u0430\u0447\u0438 (\u0438\u043b\u0438 \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0430, \u0435\u0441\u043b\u0438 \u0443\u0436\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f) <code>Cancel()</code> \u041e\u0442\u043c\u0435\u043d\u0430 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0437\u0430\u0434\u0430\u0447\u0438"},{"location":"ru/api/syncutil/#_2","title":"\u041f\u0440\u0438\u043c\u0435\u0440","text":"<pre><code>var runner syncutil.TaskRunner\n\n// \u041e\u0431\u0435 \u0433\u043e\u0440\u0443\u0442\u0438\u043d\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0442 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442.\nch1 := runner.Do(ctx, func(ctx context.Context) error {\n    return expensiveOperation(ctx)\n})\nch2 := runner.Do(ctx, func(ctx context.Context) error {\n    return expensiveOperation(ctx) // \u043d\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u2014 \u043f\u043e\u0434\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0443\u044e\n})\n\nerr1 := &lt;-ch1\nerr2 := &lt;-ch2 // \u0442\u043e \u0436\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u0447\u0442\u043e \u0438 err1\n</code></pre>"},{"location":"ru/api/syncutil/#throttle","title":"Throttle","text":"<p>\u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u2014 \u043d\u0435 \u0447\u0430\u0449\u0435 \u043e\u0434\u043d\u043e\u0433\u043e \u0440\u0430\u0437\u0430 \u0437\u0430 \u043f\u0435\u0440\u0438\u043e\u0434.</p> <pre><code>type Throttle struct {\n    Period time.Duration\n}\n</code></pre> <p>\u041c\u0435\u0442\u043e\u0434\u044b:</p> \u041c\u0435\u0442\u043e\u0434 \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>Next() bool</code> \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 true, \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0438\u043e\u0434 \u043f\u0440\u043e\u0448\u0451\u043b <code>Reset()</code> \u0421\u0431\u0440\u043e\u0441 throttle <code>Set(time.Time)</code> \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438"},{"location":"ru/api/syncutil/#multitask","title":"Multitask","text":"<p>\u0417\u0430\u043f\u0443\u0441\u043a N \u0437\u0430\u0434\u0430\u0447 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u043e \u0441 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u043e\u0439 \u043e\u0442\u043c\u0435\u043d\u044b.</p> <pre><code>type Multitask struct {\n    ContinueOnError bool   // \u041d\u0435 \u043e\u0442\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u0438 \u043e\u0448\u0438\u0431\u043a\u0435 Goer\n    Goer            GoerFn // \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u0437\u0430\u043f\u0443\u0441\u043a \u0433\u043e\u0440\u0443\u0442\u0438\u043d\n}\n</code></pre> <p>\u041c\u0435\u0442\u043e\u0434\u044b:</p> \u041c\u0435\u0442\u043e\u0434 \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 <code>Do(ctx, n, actor) error</code> \u0417\u0430\u043f\u0443\u0441\u043a actor n \u0440\u0430\u0437 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u043e"},{"location":"ru/api/syncutil/#_3","title":"\u0412\u0441\u043f\u043e\u043c\u043e\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438","text":"<pre><code>// Every \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 n \u0437\u0430\u0434\u0430\u0447; \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u0432\u0441\u0435 \u043f\u0440\u0438 \u043f\u0435\u0440\u0432\u043e\u0439 \u043e\u0448\u0438\u0431\u043a\u0435.\nfunc Every(ctx context.Context, n int, actor func(context.Context, int) error) error\n\n// Each \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 n \u0437\u0430\u0434\u0430\u0447; \u0436\u0434\u0451\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445.\nfunc Each(ctx context.Context, n int, actor func(context.Context, int))\n</code></pre>"}]}